<!DOCTYPE html>
<html>
    <head>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
	  (adsbygoogle = window.adsbygoogle || []).push({
		google_ad_client: "ca-pub-0980023289791742",
		enable_page_level_ads: true
	  });
	</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>RestEasy İle Restful Web Servis Dersleri 17 - JAX-RS Content Negotiation</title>
    <meta name="description" content="Merhabalar.">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://ilkaygunel.com/blog/2016/content-negotiation/">
    <link rel="alternate" type="application/rss+xml" title="İlkay Günel - Blog" href="http://ilkaygunel.com/feed.xml" />
      <!-- Begin Jekyll SEO tag v2.0.0 -->
<title>RestEasy İle Restful Web Servis Dersleri 17 - JAX-RS Content Negotiation - İlkay Günel - Blog</title>
<meta property="og:title" content="RestEasy İle Restful Web Servis Dersleri 17 - JAX-RS Content Negotiation" />
<meta name="description" content="Managed Beans" />
<meta property="og:description" content="Managed Beans" />
<link rel="canonical" href="http://ilkaygunel.com/blog/2016/content-negotiation/" />
<meta property="og:url" content="http://ilkaygunel.com/blog/2016/content-negotiation/" />
<meta property="og:site_name" content="İlkay Günel - Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-10-15T20:39:20+03:00" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "RestEasy İle Restful Web Servis Dersleri 17 - JAX-RS Content Negotiation",
    "datePublished": "2016-10-15T20:39:20+03:00",
    "description": "Managed Beans",
    "url": "http://ilkaygunel.com/blog/2016/content-negotiation/"
  }
</script>
<!-- End Jekyll SEO tag -->
  </head>

  <body>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76541903-2', 'auto');
  ga('send', 'pageview');
</script>

    <main>
      <header class="site-header">
  <div class="container">
    <h1><a href="/">Ana Sayfa</a></h1>

    <button type="button" class="sliding-panel-button">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="navbar sliding-panel-content">
      <ul>
        
          <li><a href="/ilkay-gunel-cv.pdf" title="Bana Ait CV">Bana Ait CV</a></li>
        
          <li><a href="/blog/2016/git-nedir" title="Git Nedir? Nasıl Kullanılır?">Git Nedir? Nasıl Kullanılır?</a></li>
        
          <li><a href="/blog/2016/jsf-tutorials-list" title="JSF">JSF</a></li>
        
          <li><a href="/blog/2016/spring-tutorials" title="Spring 4">Spring 4</a></li>
        
          <li><a href="/blog/2016/eclipselink" title="Eclipselink">Eclipselink</a></li>
        
          <li><a href="/blog/2016/resteasy/" title="Resteasy">Resteasy</a></li>
        
          <li><a href="/blog/2016/mongodb/" title="MongoDB&Java">MongoDB&Java</a></li>
        
          <li><a href="/blog/2016/test" title="Test">Test</a></li>
        
          <li><a href="/blog/2016/useful-libraries-for-java" title="Java İçin Faydalı Kütüphaneler">Java İçin Faydalı Kütüphaneler</a></li>
        
          <li><a href="/about" title="Hakkımda">Hakkımda</a></li>
        
          <li><a href="/blog/2016/eclipse-notes" title="Eclipse">Eclipse</a></li>
        
          <li><a href="/blog/2016/formula1/" title="Formula 1">Formula 1</a></li>
        
          <li><a href="/blog/2016/kitaplar" title="Kitaplar">Kitaplar</a></li>
        
          <li><a href="/blog" title="Blog">Blog</a></li>
        
        <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="sliding-panel-fade-screen"></div>


      <div class="container">
        <article role="article" class="post">

  <div class="card">
    <header class="post-header">
      <h1 class="post-title">RestEasy İle Restful Web Servis Dersleri 17 - JAX-RS Content Negotiation</h1>
      <p class="post-meta">Oct 15, 2016</p>
    </header>

    <div class="post-content">
      <p>Merhabalar.</p>

<p>Bu yazıda Content Negotiation konusuna değineceğiz.</p>

<p>Content Negotiation konusu dilimize çevirmek istersek istemci ile sunucu arasındaki içerik anlaşması denilebilir. HTTP protokolünün inşa edildiği şekile bakıldığında kullanıcının
ne tür veri göndereceği ve sunucunun ne tür veri kabul edeceğinin özelleştirilmesidir. JAX-RS içerisinde kabul edilecek içerik türü <strong><em>@Consumes</em></strong> notasyonu ile, üretilecek içerik de <strong><em>@Produces</em></strong>
notasyonu ile belirleniyor.</p>

<p>Örneğin şöyle bir kod bloğumuz olduğunu kabul edelim. Bu kabule göre yazılan web servisin öncelikli tercihi sınıfın da işaretli olduğu <strong><em>text/</em></strong><em>‘dır. Fakat bu web servisi kullanan bir müşteri
text/xml tipinde bir veri gönderse sistem bunu reddetmeyecek ve ikinci sıradaki <strong>*jaxbBook</strong></em> ismindeki POST metoduna yönlendirecektir. Örneğin kullanıcı text/plain tipinde bir veri gönderirse birinci
kurala (text/*) uyduğu için birinci POST metoduna girecektir. Ama text/xml tipinde veri gönderirse bu özel olarak ikinci POST metoduna uyduğu için işlem orada yapılacaktır. Content Negotiation
konusunun asıl amacı da budur zaten. Aynı URL üzerinden farklı veri tiplerinde hizmet verebilmektir.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Consumes</span><span class="o">(</span><span class="s">"text/*"</span><span class="o">)</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">"/library"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>
    <span class="nd">@POST</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">stringBook</span><span class="o">(</span><span class="n">String</span> <span class="n">book</span><span class="o">)</span> <span class="o">{...}</span>
    
    <span class="nd">@Consumes</span><span class="o">(</span><span class="s">"text/xml"</span><span class="o">)</span>
    <span class="nd">@POST</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">jaxbBook</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{...}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Olaya bir de @Produces notasyonu açısından bakalım. Örneğin bir GET metodu vasıtası ile bir çağırım yapacağız ve bir türe göre veri elde edeceğiz. Şu kod parçasına göre eğer o GET isteğini şu
çağırımla yaparsak JSON tipinde veri elde etmiş oluruz:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Produces</span><span class="o">(</span><span class="s">"text/*"</span><span class="o">)</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">"/library"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>

<span class="nd">@GET</span>
<span class="nd">@Produces</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">getJSON</span><span class="p">(</span><span class="o">)</span> <span class="o">{...}</span>

<span class="nd">@GET</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="p">(</span><span class="o">)</span> <span class="o">{...}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>GET /library
Accept: application/json</p>

<p>Fakat RestEasy’nin dökümanına göre yukarıdaki çağrım tüm istemciler tarafından yapılamayabilir. Bazı istemciler Accept header’ını kabul etmeyebilir veya kullanmıyor olabilir. Bunun için bu içerik tercih
meselesini proje içinde bizim çözmemiz lazım. RestEasy geliştiriciliri de bunun için 2 yol yapmışlar.</p>

<ul>
  <li>URL Based Negotiation</li>
  <li>Query String Parameter-based negotiation</li>
</ul>

<p>Şimdi bunlara bir bakalım.</p>

<p><strong>URL Based Negotiation</strong></p>

<p>RestEasy içindeki 2 adet context-param’ı web.xml dosyamız içerisinde kaydettiğimizde istemciden bir Accept header’ı gelsin gelmesin onu ezeriz ve olası sorunların büyük ölçüde önüne geçmiş
oluruz. Buradaki URL based olayı ise şurdan gelmekteki adres üzerinden farklı tipteki üretilen veriler alınabilir.</p>

<p>Şimdi küçükü bir örnek uygulama yapalım.</p>

<p>Projemizin web.xml dosyasına iki adet context-param eklenecek. O eklenen context-param’lar şu şekildedir:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span>
	<span class="na">version=</span><span class="s">"2.5"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;display-name&gt;</span>RestEasyTutorials<span class="nt">&lt;/display-name&gt;</span>
	<span class="nt">&lt;context-param&gt;</span>
		<span class="nt">&lt;param-name&gt;</span>resteasy.media.type.mappings<span class="nt">&lt;/param-name&gt;</span>
		<span class="nt">&lt;param-value&gt;</span>html : text/html, json : application/json, xml : application/xml<span class="nt">&lt;/param-value&gt;</span>
	<span class="nt">&lt;/context-param&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</code></pre>
</div>

<p>web.xml dosyamıza işlediğimiz hali ile 3 adet tipte veri alabiliriz. html, json ve xml. Üstelik bu 3 tipteki veriyi @Produces notasyonunu kullanmadan, direk URL üzerinden elde edebiliceğiz.</p>

<p>Web service üretecek Java sınıfımız da şu şekilde, hiçbir @Produces notasyonu yok ve üretilecek veri tipi tanımlamadık:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">restPackage</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ws.rs.GET</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Produces</span><span class="o">;</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">"/library"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContentNegotiation</span> <span class="o">{</span>
	<span class="nd">@GET</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="n">get</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"Message Returned!"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Şimdi ben http://localhost:8080/RestEasyTutorials/restService/library.xml adresine istekte bulunuyorum ve şununla karşılaşıyorum:</p>

<p><a href="/images/contentNego1.png">
<img src="/images/contentNego1.png" style="width: 958px; height= 400px;" />
</a></p>

<p>Şimdi  de http://localhost:8080/RestEasyTutorials/restService/library.json adresine istekte bulunuyorum:</p>

<p><a href="/images/contentNego2.png">
<img src="/images/contentNego2.png" style="width: 958px; height= 400px;" />
</a></p>

<p>Gördüğümüz gibi URL üzerinden getirmek istediğimiz tipte bir veriyi sadece ilgili path’in sonuna uzantı gibi yazarak elde ediyoruz.</p>

<p><strong>Query String Parameter-based Negotiation</strong></p>

<p>RestEasy bizim verimizi istediğimiz tipte elde etmemizi URL tabanlı yapmasının yanında URL parametresi ile de yapabilir. Daha önce query string parametrelerini görmüştük. Şimdi aynı durumu
negotiation meselesi için de kullanabiliriz. Bunun için web.xml dosyamızı güncellememiz lazım. Şöyle güncelleyelim:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span>
	<span class="na">version=</span><span class="s">"2.5"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;display-name&gt;</span>RestEasyTutorials<span class="nt">&lt;/display-name&gt;</span>
	<span class="nt">&lt;context-param&gt;</span>
		<span class="nt">&lt;param-name&gt;</span>resteasy.media.type.param.mapping<span class="nt">&lt;/param-name&gt;</span>
		<span class="nt">&lt;param-value&gt;</span>valueFormat<span class="nt">&lt;/param-value&gt;</span>
	<span class="nt">&lt;/context-param&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</code></pre>
</div>

<p>web.xml’e tanımladığımız <strong><em>valueFormat</em></strong> param-value değerini URL’den bir parametre olarak göndereceğiz ve bu parametrenin değeri de veriyi ne tipte almak istediğimiz olacak. Java kodu üzerinde 
bir oynama yapmıyoruz. Şimdi http://localhost:8080/RestEasyTutorials/restService/library?valueFormat=application/json adresine istekte bulunduğumda header’lar şöyle dönüyor:</p>

<p><a href="/images/contentNego3.png">
<img src="/images/contentNego3.png" style="width: 958px; height= 400px;" />
</a></p>

<p>http://localhost:8080/RestEasyTutorials/restService/library?valueFormat=application/xml adresine istekte bulunduğumda ise header’lar şöyle:</p>

<p><a href="/images/contentNego4.png">
<img src="/images/contentNego4.png" style="width: 958px; height= 400px;" />
</a></p>

<p>Bu şekilde de URL’den gönderilen bir parametre vasıtası ile alınacak verinin formatını belirlemiş olduk.</p>

    </div>

    
<hr>

<aside id="comments" class="disqus">
  <div class="container">
    <h3><i class="icon icon-comments-o"></i> Comments</h3>
    <div id="disqus_thread"></div>
<script>

/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */
/*
var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//ilkaygunel-com.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>                                    
  </div>
</aside>

  </div>

</article>

      </div>

      <footer class="site-footer">
  <div class="container">
    <ul class="social">
  <li><a href="https://www.instagram.com/ilkay_gunel/" target="_blank"><img src="/images/instagram.png" style="width: 24px;height: 24px;"></img></a></li>
  <li><a href="https://www.facebook.com/ilkay.gunel" target="_blank"><img src="/images/facebook.png" style="width: 24px;height: 24px;"></img></a></li>
  <li><a href="https://www.youtube.com/c/ilkaygunel" target="_blank"><img src="/images/youtube.png" style="width: 24px;height: 24px;"></img></a></li>
  <li><a href="http://twitter.com/ilkaygunel" target="_blank"><img src="/images/twitter.png" style="width: 24px;height: 24px;"></img></a></li>
  <li><a href="http://github.com/ilkgunel" target="_blank"><img src="/images/github.jpg" style="width: 24px;height: 24px;"></img></a></li>
  <li><a href="http://linkedin.com/in/ilkaygunel" target="_blank"><img src="/images/linkedin.png" style="width: 24px;height: 24px;"></img></a></li>
  
</ul>
    <p class="txt-medium-gray">
      <small>&copy;2017 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


      <a href="http://github.com/ilkgune/ilkgunel.github.io" target="_blank" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#337ab7; color:#fff; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

      <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
      <script>
      $(document).ready(function() {
        $('.sliding-panel-button,.sliding-panel-fade-screen,.sliding-panel-close').on('click touchstart',function (e) {
          $('.sliding-panel-content,.sliding-panel-fade-screen').toggleClass('is-visible');
          e.preventDefault();
        });
      });
      </script>
    </main>
  </body>
</html>
